function y = phaar(x,mode,p,q)
% mode 1: to get y = Bx, where B is 2-D haar transform of level four
% mode 2: y = B'x

switch mode
    case 1
        if isvector(x)
            x = reshape(x,[p q]);
        end
        
        [a,h,v,d] = haart2(x,4);
        
        y = zeros(256);
        
        y(1:16,1:16) = a;
        y(1:16,17:32) = h{1,4}; y(1:32,33:64) = h{1,3}; y(1:64,65:128) = h{1,2}; y(1:128,129:256) = h{1,1};
        y(17:32,1:16) = v{1,4}; y(33:64,1:32) = v{1,3}; y(65:128,1:64) = v{1,2}; y(129:256,1:128) = v{1,1};
        y(17:32,17:32) = d{1,4}; y(33:64,33:64) = d{1,3}; y(65:128,65:128) = d{1,2}; y(129:256,129:256) = d{1,1};
        
        y = y(:);
        
    case 2
        x = double(x);
        if isvector(x)
            x = reshape(x,[p q]);
        end
        a = x(1:16,1:16);
        h = {x(1:128,129:256), x(1:64,65:128), x(1:32,33:64), x(1:16,17:32)};
        v = {x(129:256,1:128), x(65:128,1:64), x(33:64,1:32), x(17:32,1:16)};
        d = {x(129:256,129:256), x(65:128,65:128), x(33:64,33:64), x(17:32,17:32)};
        y = ihaart2(a,h,v,d);
        y = y(:);

end